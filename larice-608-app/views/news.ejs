<!-- views/news.ejs -->

<h2>All News</h2>

<!-- Search and Filter Form -->
<div class="filter-container">
  <form action="/news" method="GET" class="filter-form">
    <input 
      type="text" 
      name="search" 
      placeholder="Search by title..." 
      value="<%= currentSearch %>"
      class="search-input"
    >
    <select name="category" class="category-select">
      <option value="All">All Categories</option>
      <% categories.forEach(cat => { %>
        <option value="<%= cat %>" <%= currentCategory === cat ? 'selected' : '' %>>
          <%= cat %>
        </option>
      <% }) %>
    </select>
    <button type="submit">Apply</button>
  </form>
</div>


<div class="news-list-container">
  <% if (newsList.length > 0) { %>
    <% newsList.forEach(news => { %>
      <article class="news-item">
        <h3><a href="/news/<%= news.id %>"><%= news.title %></a></h3>
        <p class="news-meta">
          Posted on <%= news.createdAt.toLocaleDateString() %> 
          by <%= news.authorName %> 
          in <strong><%= news.category %></strong>
        </p>
        <p class="news-summary"><%= news.content.substring(0, 200) %>...</p>
        <a href="/news/<%= news.id %>" class="read-more">Read More</a>
      </article>
    <% }) %>
  <% } else { %>
    <p>No news posts found matching your criteria.</p>
  <% } %>
</div>

<% newsList.forEach(news => { %>
  <article class="news-item">
    <h3><a href="/news/<%= news.id %>"><%= news.title %></a></h3>
    <p class="news-meta">
      <!-- ... -->
    </p>
    <p class="news-summary"><%= news.content.substring(0, 200) %>...</p>
    <a href="/news/<%= news.id %>" class="read-more">Read More</a>

    <!-- เพิ่มส่วนนี้: Admin Actions -->
    <% if (isAuthenticated && user && (user.id === news.authorId || user.role === 'admin')) { %>
      <div class="admin-actions">
        <a href="/news/edit/<%= news.id %>" class="edit-btn">Edit</a>
        <form action="/news/delete/<%= news.id %>" method="POST" style="display: inline;">
          <button type="submit" class="delete-btn" onclick="return confirm('Are you sure you want to delete this post?');">Delete</button>
        </form>
      </div>
    <% } %>
    <!-- จบส่วนที่เพิ่ม -->

  </article>
<% }) %>